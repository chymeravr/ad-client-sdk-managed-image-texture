//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34209
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using System;
using co.chimeralabs.ads.managed.Models;
using co.chimeralabs.analytics.managed;

namespace co.chimeralabs.ads.managed
{
	public class AdInstance
	{
		private String instanceId;
		private long startTime;
		private long lastTime;
        private String adUnitId;
        private String adServingId;
		private Boolean isInstancedDisplayed = false;
        private IAdObject ao;
        private long timeResolution = 100;
		public AdInstance (String instanceId, String adUnitId, String adServingId, IAdObject adObject)
		{
            this.ao = adObject;
			this.instanceId = instanceId;
            this.adUnitId = adUnitId;
            this.adServingId = adServingId;
			startTime = DateTime.Now.Ticks / TimeSpan.TicksPerMillisecond;
			lastTime = 0;
		}
		public String GetInstanceId(){
			return this.instanceId;
		}
        public String GetAdUnitId()
        {
            return this.adUnitId;
        }
        public String GetAdServingId()
        {
            return this.adServingId;
        }
		public void UpdateVisibilityMetric(){
			long newTime = DateTime.Now.Ticks / TimeSpan.TicksPerMillisecond - startTime;
			if ((newTime - lastTime) > timeResolution){
				lastTime = newTime;
                ao.Update();
                AppParams param = AdConfigurer.GetAppParams();
                InstanceParamsUpdateLog dtoObj = new InstanceParamsUpdateLog(param.userId, this.adUnitId, this.adServingId, this.instanceId, newTime, ao.CameraLA_X(), ao.CameraLA_Y(), ao.CameraLA_Z(), ao.CameraX(), ao.CameraY(), ao.CameraZ(), ao.AdObjectX(), ao.AdObjectY(), ao.AdObjectZ());
                AnalyticsManager.Push(dtoObj, AnalyticsManager.TYPE.VISIBILITY_METRIC, AnalyticsManager.PRIORITY.LOW);
			}
		}
		public void MarkInstanceDisplayedTrue(){
			isInstancedDisplayed = true;
		}
		public Boolean IsInstanceDisplayed(){
			return this.isInstancedDisplayed;
		}
	}
}